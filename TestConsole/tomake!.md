Я застрял на делании газет, это надо преодолеть. Буду планировать и протоколировать действия. 
Общая схема следующая:

Сначала я размещаю по заданным uri максимальное количество scanned/dz документов. 

Могут появиться дубли, как-то их устраняю. Причем могут быть документы с тем же идентификатором,
документы с теми же годом и номером (номерами), документы с одинаковыми uri.

Потом я смотрю какие pdf остались не использованными. Их как-то надо внедрить в базу данных. 

Потом придумаю что делать дальше. 

Начинаю с первого пункта. Пока только виртуальное размещение, т.е. вычисление характеристик файла
и uri.

### 20200520 11:14
В результате предыдущих мероприятий, число ненайденных файлов осталось 5. Для каждого из них я вижу
его прототип, установить соответствие можно вручную. Например, в документе имя записано какприложение 
'приложение №1' год 1995, а в файлах есть  
D:\FactographProjects\NVS\PDF_склеенные номера\1995\1995_приложение-1.pdf

Попробую выставить эти соотвествия, пока я в теме. 

Хоть и коряво, но получилось. Теперь все dz-документы имеют соответствующий pdf. Пока этот pdf 
находится где-то в директории NVS. Что еще надо бы сделать. 
1 Проверить, что все документы имеют уникальные идентификаторы
2 Проверить, что все файлы разные (по именам)
3 Проверить, что все uri разные

А потом еще надо будет заняться теми 631 pdf-документами, которые не попали в базу данных.

Проверять буду заводя словари {id, fname}, {fname, id}, {uri, id}.

### 20200521 11:12
После исправлений, осталось 8 наложений по именам pdf. Надо разобраться. 

  <document rdf:about="newspaper_28775">
    <name>2</name>
    <iisstore documenttype="scanned/dz" uri="iiss://newspaper@iis.nsk.su/0015/0137" />
    <from-date>1976</from-date>
  </document>
  <document rdf:about="newspaper adds_1105">
    <name>02</name>
    <from-date>1976</from-date>
    <iisstore documenttype="scanned/dz" uri="iiss://newspaper adds@iis.nsk.su/0001/0156" />
  </document>

Это несоответствие, к сожалению, надо убрать физически. Я в кассете "newspaper adds"
закомментирую запись и смежные записи.

Фазу проверки/обработки я завершил. Теперь надо убедиться в том, что все uri уникальные

Проверил. Теперь надо бы проверить какие pdf-файлы остались вне базы данных, но это можно будет
сделать позднее.

Следующий этап - переписывание pfd-файлов по местам, определенным uri. В принципе, это несложно,
но ответственно. 

В очередной раз я застрял  на том, что есть какая-то лишняя информация  "газетных" кассетах. Можно эту информацию "почикать", но хотелось бы сохранить "на всякий случай".

### 20200522 09:18
Пришлось звонить Алексею Фурсенко. Надо было узнать есть ли оригиналы сканов страниц. Он затруднился ответить определенно. Вроде есть. Но деталей он не помнит. 

В общем, что есть у меня и что можно и нужно сделать. Есть две кассеты имеющие отношение к газетам: 'newspaper' и 'newspaper adds'. Что есть в первой и что есть во второй?

В кассете 'newspaper' есть некоторый meta/newspaper_current.fog. Это содержательный файл, в нем находится база данных, содержащая документы типа scanned/dz. И папки, видимо группирующие документы. Но еще есть не имеющие смысла  
```
  <scanned-page rdf:about="newspaper_14859_1961_1_1">
    <page-number>1</page-number>
    <scanned-document rdf:resource="newspaper_14858_1961_1" />
    <photo-page rdf:resource="newspaper_0002_0685" />
  </scanned-page>
```
Здесь со сканированным документом, видимо номером газеты, сопоставляется фотография. Делается это (кажется) через отдельную базу данных originals/0014/0780.fog

Ссылка на эту база данных есть в начале мета документа. А сами фотки размещены в documents/medium/*.jpg

Нужны эти фотки ли нет - непонятно. Но они лишь в medium-размере, т.е. слишком мелкие.
Кроме того, части фоток там нет, посмотрю в базу данных. В базе 0780.fog их также нет... В общем, пока фотографии имеет смысл игнорировать. 

### 20200526 11:08
В общем, пришел к тому, что у меня уже было, что я вроде почти сделал - надо "оставить" кассеты в том состоянии, которое есть, и сделать новую кассету. Надеюсь какой-то прошлый код поможет мне в этом...

Итак, первых несколько этапов я вроде как прошел. Совсем крошечными изменениями я установил соответствие между scanned/dz документами и pdf-документами. Причем в документах базы данных есть еще и uri, так что месо расположения уже определено. 

### 20200528 12:54
Я попытался проверить использование документов, определенный в кассете 'newspaper adds'. Не нашел, хотя в воспоминаниях что-то такое было. В принципе, речь идет о 28 документах. Поскольку мне еще надо будет вводить около 660 документов (номеров газеты), то можно о них пока не беспокоиться. 

Итак, начинаю формировать новую кассету, перерабатывая только newspaper. Для надежности, кассету назову также и, в основном, буду действовать способом выкидывания. 

### 20200531 12:35
Последний день месяца, последний день весны...

Я потратил усилия на то, чтобы привести в порядок средства для дальнейшей рабботы. Мне нужна программа преобразования базы данных, программа подкачки файлов .pdf и, главное, программу визуализации данных SoranCore. Некоторую реорганизацию пришлось проводить поскольку данные у меня на машине Sergey, а там я пока не поставил VisualStudio, хочу обойтись лишь .NET SDK и VSCode. Теперь я сделал общее решение для моей машины и сергеевой машины и обмениваюсь через синхронизацию.

У меня были проблемы с тем, что часть dz-документов имели переопределение в базах пользователей. Надо проверить этот момент.

Вручную я насчитал 146 определений, надо посмотреть чему они соответствуют в кассете newspaper. 

Получается вроде следующее: переопределения выправляют имя документа, напр. вместо 10 делают 010 или убирают из документа дату (год). Видимо надо писать программу. Причем надо из пользовательских баз изъять переопределяемые документы. По этому поводу меня по-прежнему мучат сомнения. Хватит сомневаться. Надо выписать кассеты, которые буду менять, сохранить копии и вручную (!) убрать переопределения. Действую.

Это документы PA_Users 0001, 0002, 0008. Причем 8-й документ изменялся 20.02.2020, 2-й документ изменялся 18.05.20 и только 1-й документ менялся в 13 году. 

Все же я сохранил эти файлы в fromPA_Users_cassette. Потом выкинул ВСЕ определения документов с типом scanned/dz. Теперь можно переписывать мета-базу данных и исправлять ее. Оригинал возьму в старой кассете newspaper, а писать буду в новую метаинформацию в кассету PA_newspapers/newspaper. Поменяю файлы. 

### 20200602 14:32
Теперь я буду переписывать элементы из старой мета-базы данных в новую, иногда модифицируя. Убеждаюсь, что "пустышка" уже имеется. 

### 20200603 09:01
Вчера и сегодня утром добился того, что база данных стала нормальной. Не хватает .pdf документов в кассете. Потом я еще проанализирую какие есть .pdf файлы и включу их через документы и коллекции. Это потом. 
Сейчас буду размещать файлы по кассете. Вроде у всех документов есть нормальное uri. Я уже проверял то, что все uri различны. 

Теперь буду переписывать. У меня при обработке документа есть uri и имя файла. По uri (для .pdf) получаем директорию и номер файла. Потом проверяем, что этот файл отсутствует, если так, то копируем под новым именем. Как-то так...

Вроде первая часть - получилась. Статистика следующая: число переписанных .pdf файлов 1728 (что совпадает с к-вом файлов в базе данных), объем данных 36.1 Гб.
Источник - множество pfd-файлов, подготовленных вручную. Всего их 2389, объемом 45.8 Гб.

### 20200604 10:28
Теперь надо сделать визуализацию pdf-документов. Для этого надо вернуться в SoranCore и покорректировать соответствующие режимы визуализации.

### 20200607 11:23
Каждый шаг приходится предолевать "с боем". Попытался запустить SoranCore, именно который я хочу сделать (кроме изменений в данных), появились проблемы с IIS, портами, вспомнил про публикацию, сделал, переделал на 80-й порт и, наконец, я запустил приложение дистанционно через браузер и увидел какую-то картинку. Все забыл... Но вспомнил...

### 20200608 06:15
Папе сегодня 95 лет! Жалко, что не будет торжественных мероприятий. Ни памятника в Академгородке, ни улицы его имени пока не удалось организовать... Даже в НГУ пока нет должного увековечения. Последнее - в том числе и моя недоработка!

Процесс работы над газетой продолжается, но так медленно... Сегодня решил начать с того, чтобы "прикрепить" годы не к кассете, а к коллекции. Допустим, назову эту коллекцию newspaperNVScollection.
Проще это сделать прямым редактированием базы данных кассеты, но пока я продолжу делать изменения программным способом. Вперед!


http://soran1957.ru/Default.aspx?r=small&u=iiss://PA_folders24-59@iis.nsk.su/0001/0004/0392



