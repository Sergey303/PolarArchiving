
@model ShowModel
@{
    ViewData["Title"] = "Show";
    Func<string, string> OntNm = nm => OAData.Ontology.GetOntName(nm);
    Func<string, string> InvOntNm = nm => OAData.Ontology.GetInvOntName(nm);
    var uri = Model.Rec.fields
        .FirstOrDefault(f => f.prop == "http://fogid.net/o/uri")
        ?.value;
}

<h1>Show</h1>

@if (uri != null)
{
    var docmetainfo = Model.Rec.fields
        .FirstOrDefault(f => f.prop == "http://fogid.net/o/docmetainfo")
        ?.value;
    string documenttype = null;
    if (docmetainfo != null)
    {
        documenttype = docmetainfo.Split(';')
            .FirstOrDefault(part => part.StartsWith("documenttype:"))?.Substring(13);
        string url = System.Web.HttpUtility.UrlEncode(uri);
        @if (documenttype == "application/pdf")
        {
            string src = Url.Content("~/Docs/GetPdf?u=" + url); 
            <embed src="@src" width="800" height="400" />
        }
        else if (documenttype.StartsWith("image/"))
        {
            <img src="~/Docs/GetPhoto?u=@(url)&amp;s=medium" />
        }
        <div>@documenttype</div>
    }
}
<table border="1">
    <tr>
        <td colspan="3"><span style="color:red;">@OntNm(Model.Rec.Tp)</span>  @(Model.Rec.Id)</td>
    </tr>
    @foreach (var tri in Model.Rec.fields)
    {
        <tr>
            <td>@OntNm(tri.prop)</td>
            <td>@tri.value</td>
            <td>@tri.lang</td>
        </tr>
    }

    @foreach (var qq in Model.Rec.inverses)
    {
        <tr>
            <td colspan="3">
                <span style="color:red;">@(InvOntNm(qq.prop))</span>
            </td>
        </tr>
        @foreach (var r in qq.recs)
        {
            Direct ddirect = r.directs.FirstOrDefault();
            <tr>
                <td>
                    @for (int i = 0; i < r.fields.Length; i++)
                    {
                        Field f = r.fields[i];
                        <span style="color:green;">@(OntNm(f.prop)): </span>
                        <span>"@(f.value + (string.IsNullOrEmpty(f.lang) ? "" : "@" + f.lang))"</span>
                        @if (i != r.fields.Length - 1)
                        {
                            <span>, </span>
                        }
                    }
                </td>
                <td>@(ddirect == null ? "" : OntNm(ddirect.prop))</td>
                <td>
                    @if (ddirect != null && ddirect.rec != null)
                    {
                        string u = ddirect.rec.fields
                            .FirstOrDefault(f => f.prop == "http://fogid.net/o/uri")
                            ?.value;
                        string dmi = ddirect.rec.fields
                            .FirstOrDefault(f => f.prop == "http://fogid.net/o/docmetainfo")
                            ?.value;
                        if (u != null)
                        {
                            string doctype = dmi?.Split(';')
                                .FirstOrDefault(met => met.StartsWith("documenttype:"))
                                ?.Substring(13);
                            if (doctype.StartsWith("image/"))
                            {
                                <img src="~/Docs/GetPhoto?s=small&amp;u=@(u)" align="right" />
                            }
                            //else if (doctype == "application.pdf") {  }
                            else
                            {
                                <img src="~/img/document.jpg" align="right" />
                            }
                        }
                        <a href="?id=@ddirect.rec.Id">@('@')</a>
                        @for (int i = 0; i < ddirect.rec.fields.Length; i++)
                        {
                            Field f = ddirect.rec.fields[i];
                            @if (f.prop == "http://fogid.net/o/uri" || f.prop == "http://fogid.net/o/docmetainfo")
                            {
                            }
                            else
                            {
                                <span style="color:green;">@(OntNm(f.prop)): </span>
                                <span>"@(f.value + (string.IsNullOrEmpty(f.lang) ? "" : "@" + f.lang))"</span>
                            }
                            @if (i != r.fields.Length - 1)
                            {
                                <span>, </span>
                            }
                        }
                    }
                </td>
            </tr>
        }
    }
</table>

